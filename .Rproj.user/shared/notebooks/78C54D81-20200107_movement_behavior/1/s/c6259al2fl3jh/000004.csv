"0","# Select just one site to work with."
"0","ska <- df %>% filter(site == 'SKA')"
"0",""
"0","# Do the datetime thing."
"0","ska$date <- date(ska$date)"
"0","ska$datetime <- ymd_hms(ska$datetime)"
"0",""
"0","# Get sunrise and sunset times."
"0","ska.times <-  getSunlightTimes(data=ska, keep=c('sunrise', 'sunset'), "
"0","                        tz='America/Vancouver')"
"0",""
"0","# Bind to location points."
"0","ska <- left_join(ska, ska.times, by=c('date', 'lat', 'lon'))"
"0",""
"0","# Designate points as day or night."
"0","ska$diff.rise <- as.numeric(difftime(ska$datetime, "
"0","                                     ska$sunrise, units='hours'))"
"0","ska$diff.set <- as.numeric(difftime(ska$datetime, "
"0","                                    ska$sunset, units='hours'))"
"0",""
"0","ska$t.period <- case_when("
"0","  ska$diff.rise >= 0 & ska$diff.set <= 0 ~ 'day',"
"0","  TRUE ~ 'night'"
"0",")"
"0",""
"0","ska <- ska %>% filter(t.period == 'day')"
"0",""
"0","# Convert to sp and specify coordinates."
"0","coordinates(ska) <- c('lon', 'lat')"
"0",""
"0","# Define current projection."
"0","proj4string(ska) <- CRS(""+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"")"
"0",""
"0","# Convert to UTM."
"0","ska <- spTransform(ska, CRS('+proj=utm +zone=10 +datum=WGS84 +units=m +no_defs'))"
"0",""
"0","# Rename from lat/lon to x/y."
"0","colnames(ska@coords) <- c('x', 'y')"
"0",""
"0","# Return to data frame because that's what moveHMM wants."
"0","ska <- as.data.frame(ska)"
"0",""
"0","# Send to moveHMM."
"0","data <- prepData(ska, type=""UTM"", coordNames=c('x','y'))"
