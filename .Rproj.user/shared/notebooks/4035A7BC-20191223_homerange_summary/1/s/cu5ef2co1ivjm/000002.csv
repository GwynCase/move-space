"0","# Read in the data."
"0","df <- read.csv('../data/processed/telem_all.csv',"
"0","               header=TRUE, stringsAsFactors=FALSE) %>%"
"0","  drop_na('lat')"
"0","# Do the datetime thing."
"0","df$datetime <- ymd_hms(df$datetime, tz='America/Vancouver')"
"0","# Create intervals."
"0","winter2 <- interval(ymd(20190101), ymd(20190414))"
"0","incubation <- interval(ymd(20190415), ymd(20190510))"
"0","nestling <- interval(ymd(20190511), ymd(20190710))"
"0","fledgling <- interval(ymd(20190711), ymd(20190901))"
"0","winter1 <- interval(ymd(20190902), ymd(20191231))"
"0","# Assign locations to period."
"0","df <- df %>%"
"0","  mutate(yrls=ymd(paste(2019, month(datetime), day(datetime))),"
"0","         period=case_when("
"0","           yrls %within% incubation ~ 'incubation',"
"0","           yrls %within% nestling ~ 'nestling',"
"0","           yrls %within% fledgling ~ 'fledgling',"
"0","           yrls %within% winter1 ~ 'winter',"
"0","           yrls %within% winter2 ~ 'winter'"
"0","         )"
"0","  )"
"0","# Do the spatial thing."
"0","sf.df <- st_as_sf(df, coords=c('lon', 'lat')) %>%"
"0","  st_set_crs('+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs') %>%"
"0","  st_transform(""+proj=utm +zone=10 +datum=WGS84 +units=m +no_defs"")"
"0","# 50% and 95% MCP for each tag and all points."
"0","mcp.all <- sf.df %>%"
"0","  dplyr::select(geometry, id) %>%"
"0","  as_Spatial() %>%"
"0","  mcp.area(percent=c(50, 95),"
"0","           unin='m', unout='ha', plotit=FALSE)%>%"
"0","  rownames_to_column(var='name') %>%"
"0","  mutate(percent=as.numeric(name)) %>%"
"0","  dplyr::select(-name)"
"0","# Add new columns"
"0","mcp.all <- mcp.all %>%"
"0","  add_column(method='MCP', period='total')"
"0","# Fix formatting so it can actually be graphed."
"0","mcp.all <- pivot_longer(mcp.all,"
"0","  cols=c('HAR04', 'HAR05', 'HAR07', 'HAR08', 'HAR09', 'HAR10'), names_to='id')"
"0","# 50% and 95% MCP for each tag and nestling points."
"0","mcp.nest <- sf.df %>%"
"0","  filter(period == 'nestling') %>%"
"0","  dplyr::select(geometry, id) %>%"
"0","  as_Spatial() %>%"
"0","  mcp.area(percent=c(50, 95),"
"0","           unin='m', unout='ha', plotit=FALSE)%>%"
"0","  rownames_to_column(var='name') %>%"
"0","  mutate(percent=as.numeric(name)) %>%"
"0","  dplyr::select(-name)"
"0","mcp.nest <- mcp.nest %>%"
"0","  add_column(method='MCP', period='nestling') %>%"
"0","  pivot_longer(cols=c('HAR04', 'HAR05', 'HAR07', 'HAR08', 'HAR09', 'HAR10'),"
"0","               names_to='id')"
"0","# 50% and 95% MCP for each tag and fledgling points."
"0","mcp.fledge <- sf.df %>%"
"0","  filter(period == 'fledgling') %>%"
"0","  dplyr::select(geometry, id) %>%"
"0","  as_Spatial() %>%"
"0","  mcp.area(percent=c(50, 95),"
"0","           unin='m', unout='ha', plotit=FALSE)%>%"
"0","  rownames_to_column(var='name') %>%"
"0","  mutate(percent=as.numeric(name)) %>%"
"0","  dplyr::select(-name)"
"0","mcp.fledge <- mcp.fledge %>%"
"0","  add_column(method='MCP', period='fledgling') %>%"
"0","  pivot_longer(cols=c('HAR05', 'HAR07'),"
"0","               names_to='id')"
"0","# 50% and 95% MCP for each tag and winter points."
"0","mcp.wint <- sf.df %>%"
"0","  filter(period == 'winter') %>%"
"0","  dplyr::select(geometry, id) %>%"
"0","  as_Spatial() %>%"
"0","  mcp.area(percent=c(50, 95),"
"0","           unin='m', unout='ha', plotit=FALSE)%>%"
"0","  rownames_to_column(var='name') %>%"
"0","  mutate(percent=as.numeric(name)) %>%"
"0","  dplyr::select(-name)"
"0","mcp.wint <- mcp.wint %>%"
"0","  add_column(method='MCP', period='winter') %>%"
"0","  pivot_longer(cols=c('HAR05', 'HAR07'),"
"0","               names_to='id')"
"0","# Now make a kud."
"0","kud.all <- sf.df %>%"
"0","  dplyr::select(id, geometry) %>%"
"0","  as_Spatial() %>%"
"0","  kernelUD(extent=0.25, grid=100) %>%"
"0","  kernel.area(percent=95, unin='m', unout='ha') %>%"
"0","  as.data.frame %>%"
"0","  rownames_to_column(var='name') %>%"
"0","  mutate(percent=as.numeric(name)) %>%"
"0","  dplyr::select(-name) %>%"
"0","  add_column(method='KDE', period='total') %>%"
"0","  pivot_longer(cols=c('HAR04', 'HAR05', 'HAR07', 'HAR08', 'HAR09', 'HAR10'),"
"0","               names_to='id')"
"0","# And for 50%."
"0","k.a.50 <- sf.df %>%"
"0","  dplyr::select(id, geometry) %>%"
"0","  as_Spatial() %>%"
"0","  kernelUD(extent=0.25, grid=100) %>%"
"0","  kernel.area(percent=50, unin='m', unout='ha') %>%"
"0","  as.data.frame %>%"
"0","  rownames_to_column(var='name') %>%"
"0","  mutate(percent=as.numeric(name)) %>%"
"0","  dplyr::select(-name) %>%"
"0","  add_column(method='KDE', period='total') %>%"
"0","  pivot_longer(cols=c('HAR04', 'HAR05', 'HAR07', 'HAR08', 'HAR09', 'HAR10'),"
"0","               names_to='id')"
"0","# For nestling 95%."
"0","k.n.95 <- sf.df %>%"
"0","  filter(period == 'nestling') %>%"
"0","  dplyr::select(geometry, id) %>%"
"0","  as_Spatial() %>%"
"0","  kernelUD(extent=0.3, grid=100) %>%"
"0","  kernel.area(percent=95, unin='m', unout='ha') %>%"
"0","  as.data.frame %>%"
"0","  rownames_to_column(var='name') %>%"
"0","  mutate(percent=as.numeric(name)) %>%"
"0","  dplyr::select(-name) %>%"
"0","  add_column(method='KDE', period='nestling') %>%"
"0","  pivot_longer(cols=c('HAR04', 'HAR05', 'HAR07', 'HAR08', 'HAR09', 'HAR10'),"
"0","               names_to='id')"
"0","# For nestling 50%."
"0","k.n.50 <- sf.df %>%"
"0","  filter(period == 'nestling') %>%"
"0","  dplyr::select(geometry, id) %>%"
"0","  as_Spatial() %>%"
"0","  kernelUD(extent=0.3, grid=100) %>%"
"0","  kernel.area(percent=50, unin='m', unout='ha') %>%"
"0","  as.data.frame %>%"
"0","  rownames_to_column(var='name') %>%"
"0","  mutate(percent=as.numeric(name)) %>%"
"0","  dplyr::select(-name) %>%"
"0","  add_column(method='KDE', period='nestling') %>%"
"0","  pivot_longer(cols=c('HAR04', 'HAR05', 'HAR07', 'HAR08', 'HAR09', 'HAR10'),"
"0","               names_to='id')"
"0","# For fledgling 95%"
"0","k.f.95 <- sf.df %>%"
"0","  filter(period == 'fledgling') %>%"
"0","  dplyr::select(geometry, id) %>%"
"0","  as_Spatial() %>%"
"0","  kernelUD(extent=0.3, grid=100) %>%"
"0","  kernel.area(percent=95, unin='m', unout='ha') %>%"
"0","  as.data.frame %>%"
"0","  rownames_to_column(var='name') %>%"
"0","  mutate(percent=as.numeric(name)) %>%"
"0","  dplyr::select(-name) %>%"
"0","  add_column(method='KDE', period='fledgling') %>%"
"0","  pivot_longer(cols=c('HAR05', 'HAR07'),"
"0","               names_to='id')"
"0","k.f.50 <- sf.df %>%"
"0","  filter(period == 'fledgling') %>%"
"0","  dplyr::select(geometry, id) %>%"
"0","  as_Spatial() %>%"
"0","  kernelUD(extent=0.3, grid=100) %>%"
"0","  kernel.area(percent=50, unin='m', unout='ha') %>%"
"0","  as.data.frame %>%"
"0","  rownames_to_column(var='name') %>%"
"0","  mutate(percent=as.numeric(name)) %>%"
"0","  dplyr::select(-name) %>%"
"0","  add_column(method='KDE', period='fledgling') %>%"
"0","  pivot_longer(cols=c('HAR05', 'HAR07'),"
"0","               names_to='id')"
"0","# Merge everything."
"0","hr <- bind_rows(mcp.all, mcp.nest, mcp.fledge, mcp.wint, kud.all, k.a.50, k.n.95, k.n.50, k.f.95, k.f.50)"
"0","hr <- hr %>%"
"0","  pivot_wider(names_from=period, values_from=value) %>%"
"0","  dplyr::select(id, method, percent, total, nestling, fledgling, winter) %>%"
"0","  arrange(id, method, percent)"
"0","# Create some summary stuff."
"0","df.sum <- df %>%"
"0","  dplyr::select(id, period) %>%"
"0","  group_by(id, period) %>%"
"0","  summarize(n=n())"
"0","df.sum <- df.sum %>%"
"0","  pivot_wider(names_from=period, values_from=n, values_fill=list(n=0)) %>%"
"0","  mutate(total=incubation+nestling+fledgling+winter, percent=NA, "
"0","         method='Number of points') %>%"
"0","  dplyr::select(id, method, percent, total, incubation, nestling, fledgling, winter)"
"0","# Add to main table."
"0","hr2 <- bind_rows(hr, df.sum)"
"0","hr2 <- hr2 %>%"
"0","  arrange(id, method, percent) %>%"
"0","  dplyr::select(id, method, percent, total, incubation, nestling, fledgling, winter)"
